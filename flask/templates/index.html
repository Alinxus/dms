<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram DM Sender</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #6366F1, #8B5CF6, #D946EF);
        }
        .file-input-label {
            background: linear-gradient(135deg, #3B82F6, #60A5FA);
        }
        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
        }
        .custom-file-input::before {
            content: 'Select file';
            display: inline-block;
            background: linear-gradient(135deg, #3B82F6, #60A5FA);
            border: none;
            border-radius: 0.375rem;
            padding: 0.5rem 1rem;
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            color: #ffffff;
            font-weight: 700;
            font-size: 0.875rem;
        }
        .custom-file-input:hover::before {
            background: linear-gradient(135deg, #2563EB, #3B82F6);
        }
        .custom-file-input:active::before {
            background: linear-gradient(135deg, #1D4ED8, #2563EB);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
        <div class="gradient-bg p-8 text-white">
            <h1 class="text-4xl font-bold mb-2 text-center">Instagram DM Sender</h1>
            <p class="text-center text-gray-200">Connect and message with ease</p>
        </div>
        
        <div class="p-8 space-y-6">
            <div>
                <label for="contactsInput" class="block text-sm font-medium text-gray-700 mb-1">Contacts (comma-separated)</label>
                <textarea id="contactsInput" placeholder="Enter Instagram usernames separated by commas..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 h-24 resize-none transition duration-300 ease-in-out"></textarea>
            </div>

            <div class="flex items-center justify-center mb-4">
                <span class="text-sm text-gray-600">OR</span>
            </div>
            
            <div>
                <label for="contactsFile" class="block text-sm font-medium text-gray-700 mb-1">Contacts CSV</label>
                <input type="file" id="contactsFile" accept=".csv"
                    class="custom-file-input w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-violet-50 file:text-violet-700
                    hover:file:bg-violet-100">
            </div>
            
            <div>
                <label for="cookiesFile" class="block text-sm font-medium text-gray-700 mb-1">Cookies JSON</label>
                <input type="file" id="cookiesFile" accept=".json" onchange="handleCookiesFile(this.files[0])"
                    class="custom-file-input w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-violet-50 file:text-violet-700
                    hover:file:bg-violet-100">
            </div>

            <div>
                <label for="useSavedCookies" class="flex items-center">
                    <input type="checkbox" id="useSavedCookies" class="mr-2">
                    <span class="text-sm text-gray-700">Use saved cookies</span>
                </label>
            </div>
            
            <div>
                <label for="customMessage" class="block text-sm font-medium text-gray-700 mb-1">Custom Message</label>
                <textarea id="customMessage" placeholder="Enter your custom message here..."
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 h-32 resize-none transition duration-300 ease-in-out"></textarea>
            </div>
        </div>
        
        <div class="px-8 pb-8">
            <button onclick="sendDMs()" 
                class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:from-purple-600 hover:to-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                Send DMs
            </button>

            <div id="resultContainer" class="mt-4 text-center"></div>
        </div>
    </div>

    <script>
        function handleCookiesFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                localStorage.setItem('instagramCookies', e.target.result);
                alert('Cookies saved successfully!');
            };
            reader.readAsText(file);
        }

        function getSavedCookies() {
            return localStorage.getItem('instagramCookies');
        }

        async function sendDMs() {
            const formData = new FormData();
            const contactsInput = document.getElementById('contactsInput').value;
            const csvFile = document.getElementById('contactsFile').files[0];
            const cookiesFile = document.getElementById('cookiesFile').files[0];
            const customMessage = document.getElementById('customMessage').value;
            const useSavedCookies = document.getElementById('useSavedCookies').checked;

            if (contactsInput) formData.append('contactsInput', contactsInput);
            if (csvFile) formData.append('contactsFile', csvFile);
            
            if (useSavedCookies) {
                const savedCookies = getSavedCookies();
                if (savedCookies) {
                    formData.append('cookiesContent', savedCookies);
                } else {
                    alert('No saved cookies found. Please upload a cookies file.');
                    return;
                }
            } else if (cookiesFile) {
                formData.append('cookiesFile', cookiesFile);
            } else {
                alert('Please either use saved cookies or upload a new cookies file.');
                return;
            }

            formData.append('customMessage', customMessage);

            const response = await fetch('/send-dms', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = `
                <p class="text-green-600 font-semibold">Success: ${result.success.length}</p>
                <p class="text-red-600 font-semibold">Failed: ${result.failed.length}</p>
            `;

            gsap.from(resultContainer.children, {
                opacity: 0,
                y: 20,
                stagger: 0.2,
                duration: 0.5,
                ease: "power2.out"
            });
        }

        window.addEventListener('load', () => {
            gsap.from("h1", { opacity: 0, y: -50, duration: 1, ease: "power3.out" });
            gsap.from("p", { opacity: 0, y: -30, duration: 1, delay: 0.3, ease: "power3.out" });
            gsap.from("textarea, input", { opacity: 0, y: 30, stagger: 0.2, duration: 0.8, ease: "power2.out" });
            gsap.from("button", { opacity: 0, y: 30, duration: 0.8, delay: 1, ease: "power2.out" });
            
            // Check if there are saved cookies and update the checkbox
            const savedCookies = getSavedCookies();
            if (savedCookies) {
                document.getElementById('useSavedCookies').disabled = false;
            } else {
                document.getElementById('useSavedCookies').disabled = true;
            }
        });
    </script>
</body>
</html>